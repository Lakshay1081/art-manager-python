<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>View Art Supplies</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', sans-serif;
        }

        h2 {
            margin-top: 30px;
            text-align: center;
            font-weight: bold;
        }

        .filter-panel {
            margin: 20px auto;
            max-width: 1000px;
        }

        canvas {
            margin: 40px auto;
            display: block;
            max-width: 90%;
        }

        .table-responsive {
            margin: 30px auto;
            max-width: 1000px;
        }

        .btn {
            margin-right: 10px;
        }

        label {
            font-weight: 500;
        }

        .chart-title {
            text-align: center;
            margin-top: 20px;
            font-weight: 500;
        }

        .filters-row {
            gap: 10px;
        }
    </style>
</head>
<body>

    <div class="container">
        <h2>ðŸŽ¨ Lakshay Pareek's Art Supplies</h2>

        <!-- FILTER PANEL -->
        <form method="GET" class="row g-3 filter-panel justify-content-center align-items-center filters-row">
            <div class="col-auto">
                <label for="category">Filter by Category:</label>
                <select name="category" class="form-select">
                    <option value="">All</option>
                    {% for c in categories %}
                        <option value="{{ c }}" {% if c == selected_category %}selected{% endif %}>{{ c }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-auto">
                <label for="from">From:</label>
                <input type="date" name="from" class="form-control" value="{{ from_date }}">
            </div>
            <div class="col-auto">
                <label for="to">To:</label>
                <input type="date" name="to" class="form-control" value="{{ to_date }}">
            </div>
            <div class="col-auto d-flex align-items-end">
                <button type="submit" class="btn btn-dark">Apply Filters</button>
            </div>
            <div class="col-auto d-flex align-items-end">
                <a href="/download_chart" class="btn btn-outline-primary">Download Chart</a>
                <a href="/export_csv" class="btn btn-outline-success">Export CSV</a>
            </div>
        </form>
        <div class="table-responsive">
            <table class="table table-striped table-bordered mt-4">
                <thead class="table-dark">
                    <tr>
                        <th>Name</th>
                        <th>Cost (â‚¹)</th>
                        <th>Quantity</th>
                        <th>Purchase Date</th>
                        <th>Category</th>
                    </tr>
                </thead>
                <tbody>
                    {% for supply in supplies %}
                    <tr>
                        <td>{{ supply.name }}</td>
                        <td>{{ supply.cost }}</td>
                        <td>{{ supply.quantity }}</td>
                        <td>{{ supply.purchase_date }}</td>
                        <td>{{ supply.category or "Uncategorized" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <!-- CHARTS -->
        <div class="chart-section">
            <h5 class="chart-title">Cost vs Quantity</h5>
            <canvas id="costQuantityChart"></canvas>

            <h5 class="chart-title">Category-wise Spend</h5>
            <canvas id="categoryPieChart"></canvas>

            <h5 class="chart-title">Top 5 Most Expensive Supplies</h5>
            <canvas id="top5Chart"></canvas>
        </div>
    </div>

    <!-- Chart JS DATA -->
    <script>
  const supplyData = {{ supply_data | tojson }};
</script>

    <script>
        const supplyNames = {{ chart_names|tojson }};
        const costs = {{ chart_costs|tojson }};
        const quantities = {{ chart_quantities|tojson }};
        const topNames = {{ top5_names|tojson }};
        const topCosts = {{ top5_costs|tojson }};
        const catLabels = {{ category_labels|tojson }};
        const catValues = {{ category_values|tojson }};

        new Chart(document.getElementById('costQuantityChart'), {
            type: 'bar',
            data: {
                labels: supplyNames,
                datasets: [
                    { label: 'Cost (â‚¹)', data: costs, backgroundColor: '#00bcd4' },
                    { label: 'Quantity', data: quantities, backgroundColor: '#9c27b0' }
                ]
            },
            options: { responsive: true }
        });

        new Chart(document.getElementById('categoryPieChart'), {
            type: 'pie',
            data: {
                labels: catLabels,
                datasets: [{
                    data: catValues,
                    backgroundColor: ['#f06292', '#42a5f5', '#66bb6a', '#ffb74d', '#ba68c8', '#90a4ae', '#d4e157']
                }]
            }
        });

        new Chart(document.getElementById('top5Chart'), {
            type: 'bar',
            data: {
                labels: topNames,
                datasets: [{
                    label: 'Top 5 Most Expensive Supplies (â‚¹)',
                    data: topCosts,
                    backgroundColor: '#ff4081'
                }]
            },
            options: { responsive: true }
        });
    </script>

</body>
</html>
